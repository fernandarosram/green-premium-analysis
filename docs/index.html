<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The Green Premium: A Web-Scraping and Monte Carlo Analysis of Agroecological Prices in Mexico City</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b0c5667e353207e4d116d0fdb76d7844.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">The Green Premium: A Web-Scraping and Monte Carlo Analysis of Agroecological Prices in Mexico City</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <span class="nav-link">
<span class="menu-text">about.qmd</span>
    </span>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives"><span class="header-section-number">2</span> Objectives</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology"><span class="header-section-number">3</span> Methodology</a>
  <ul class="collapse">
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link" data-scroll-target="#data-collection"><span class="header-section-number">3.1</span> Data Collection</a></li>
  <li><a href="#technical-rationale" id="toc-technical-rationale" class="nav-link" data-scroll-target="#technical-rationale"><span class="header-section-number">3.2</span> Technical Rationale</a></li>
  <li><a href="#data-refinement" id="toc-data-refinement" class="nav-link" data-scroll-target="#data-refinement"><span class="header-section-number">3.3</span> Data Refinement</a>
  <ul class="collapse">
  <li><a href="#unit-standardization-and-price-normalization" id="toc-unit-standardization-and-price-normalization" class="nav-link" data-scroll-target="#unit-standardization-and-price-normalization"><span class="header-section-number">3.3.1</span> Unit Standardization and Price Normalization</a></li>
  <li><a href="#product-selection-scope-the-basic-basket" id="toc-product-selection-scope-the-basic-basket" class="nav-link" data-scroll-target="#product-selection-scope-the-basic-basket"><span class="header-section-number">3.3.2</span> Product Selection &amp; Scope: The Basic Basket</a></li>
  </ul></li>
  <li><a href="#stochastic-modeling" id="toc-stochastic-modeling" class="nav-link" data-scroll-target="#stochastic-modeling"><span class="header-section-number">3.4</span> Stochastic Modeling</a></li>
  <li><a href="#price-volatility" id="toc-price-volatility" class="nav-link" data-scroll-target="#price-volatility"><span class="header-section-number">3.5</span> Price Volatility</a></li>
  <li><a href="#the-price-gap" id="toc-the-price-gap" class="nav-link" data-scroll-target="#the-price-gap"><span class="header-section-number">3.6</span> The Price Gap</a></li>
  <li><a href="#economic-viability-labor-cost-translation" id="toc-economic-viability-labor-cost-translation" class="nav-link" data-scroll-target="#economic-viability-labor-cost-translation"><span class="header-section-number">3.7</span> Economic Viability (<strong>Labor Cost Translation)</strong></a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">4</span> Results</a>
  <ul class="collapse">
  <li><a href="#price-distributions-and-volatility" id="toc-price-distributions-and-volatility" class="nav-link" data-scroll-target="#price-distributions-and-volatility"><span class="header-section-number">4.1</span> Price Distributions and Volatility</a></li>
  <li><a href="#quantifying-the-green-premium" id="toc-quantifying-the-green-premium" class="nav-link" data-scroll-target="#quantifying-the-green-premium"><span class="header-section-number">4.2</span> Quantifying the “Green Premium”</a></li>
  <li><a href="#economic-viability" id="toc-economic-viability" class="nav-link" data-scroll-target="#economic-viability"><span class="header-section-number">4.3</span> Economic Viability</a>
  <ul class="collapse">
  <li><a href="#basic-basket-cost" id="toc-basic-basket-cost" class="nav-link" data-scroll-target="#basic-basket-cost"><span class="header-section-number">4.3.1</span> Basic Basket cost</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations"><span class="header-section-number">5</span> Limitations</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">6</span> Conclusion</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The Green Premium: A Web-Scraping and Monte Carlo Analysis of Agroecological Prices in Mexico City</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Agroecology is a movement to transform food systems in pursuit of environmental, social, gender, economic, racial, and intergenerational justice.</p>
<p>While the principles of agroecology offer a roadmap for a more resilient future, the transition from theory to the kitchen table is often dictated by a single factor: <strong>economic accessibility</strong>. In a megalopolis like Mexico City, where the industrial food chain and ancestral agricultural systems like the <em>Chinampas</em> coexist, the price tag often determines which food system a family can afford. This report looks at whether the “Green Premium” on sustainable agriculture is really out of reach for the average consumer, or just a gap that that can realistically be bridged.</p>
</section>
<section id="objectives" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Objectives</h1>
<p>In this report, I leverage <strong>web scraping</strong> and <strong>stochastic modeling</strong> to adress three key questions:</p>
<ol type="1">
<li><p><strong>Price Volatility</strong>: Which market tier exhibits the greatest price variability?</p></li>
<li><p><strong>Green Premium</strong>: What is the median percentage difference between agroecological and conventional products?</p></li>
<li><p><strong>Labor Cost Translation</strong>: How many days of minimum-wage labor are required to afford a monthly basic basket in each market tier?</p></li>
</ol>
</section>
<section id="methodology" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Methodology</h1>
<section id="data-collection" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="data-collection"><span class="header-section-number">3.1</span> Data Collection</h2>
<p>To analyze the price accessibility of sustainable food systems, I developed a multi-source web scraping pipeline to extract and standardize pricing data from three distinct market tiers in Mexico City:</p>
<ol type="1">
<li><strong>Conventional Retail Tier (Industrial Supermarkets)</strong></li>
</ol>
<p>Primary sources: <a href="https://www.walmart.com.mx/">Walmart</a> and <a href="https://www.lacomer.com.mx/">La Comer</a>. These represent the dominant retail landscape for the average citizen. They were selected due to their high geographic density and standardized pricing, serving as the “baseline” for food accessibility and industrial supply chains.</p>
<ol start="2" type="1">
<li><strong>Sustainable and Short Supply-Chain Markets</strong></li>
</ol>
<p>Primary sources: <a href="https://dilmun.mx/">Dilmun</a>, <a href="https://mercadoalternativo.org/">Mercado Alternativo</a>, <a href="https://consumaconciencia.com/">Consuma Conciencia</a> and <a href="https://www.elbuencampo.com/">El Buen Campo</a>. These specialized vendors focus on <strong>agroecological products</strong>, primarily sourced from the ancestral <em>chinampa</em> system. These markets prioritize organic practices, fair trade, and sustainability.</p>
<ol start="3" type="1">
<li><strong>The Wholesale Foundation (Central de Abasto Proxy)</strong></li>
</ol>
<p>Source: <a href="https://www.economia-sniim.gob.mx/">Central de Abasto</a> (CEDA). As the world’s largest wholesale market, the CEDA is the heart of Mexico’s food supply. Since most street market vendors and neighborhood greengrocers source their inventory directly from here, I utilized CEDA’s frequent, minimum, and maximum price points to build a stochastic proxy for local market prices. This allows the study to account for the proximity price tier that is otherwise difficult to capture via standard scraping.</p>
</section>
<section id="technical-rationale" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="technical-rationale"><span class="header-section-number">3.2</span> Technical Rationale</h2>
<p>For this project, I chose <strong>R</strong> as the core analytical engine. While many languages offer scraping capabilities, R’s ecosystem provides a seamless bridge between <strong>automated data extraction</strong>, <strong>complex statistical modeling</strong>, and <strong>high-fidelity reporting</strong> through Quarto.</p>
<ul>
<li><p><strong>Chromote</strong>: Used to interact with JavaScript-rendered retail platforms (e.g., React-based sites) and extract dynamically generated product data.</p></li>
<li><p><strong>Rvest</strong>: For markets with more traditional, server-side rendered architectures, I integrated rvest. This allowed for high-speed, efficient parsing of HTML structures, optimizing the data collection process without putting unnecessary load on the servers.</p></li>
<li><p><strong>Tidyverse</strong>: Enabled a transparent, modular data cleaning pipeline across heterogeneous data sources</p></li>
</ul>
<p>Below are snippets of the core scraping logic, demonstrating the different approaches required for different site architectures.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to see the Chromote Scraper Logic (01_scraper_supermarket.R)</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract prices from 'frutas y verduras' from retail supermarket</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean the environment</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chromote)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Load helper functions</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"scripts/00_helpers.R"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch browser</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">CHROMOTE_HEADLESS =</span> <span class="st">"0"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>my_user_agent <span class="ot">&lt;-</span> <span class="st">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36"</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new browser session</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>chrome_session <span class="ot">&lt;-</span> ChromoteSession<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>chrome_session<span class="sc">$</span>Network<span class="sc">$</span><span class="fu">setUserAgentOverride</span>(<span class="at">userAgent =</span> my_user_agent)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch chrome to view actions taken in the browser</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>chrome_session<span class="sc">$</span><span class="fu">view</span>()</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list to save data</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>supermarket_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Go to webpage</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>chrome_session<span class="sc">$</span>Page<span class="sc">$</span><span class="fu">navigate</span>(</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://www.lacomer.com.mx/lacomer/#!/pasillos/252/13?succId=252&amp;succFmt=100"</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Wait until webpage is loaded</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="dv">5</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract raw html</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>html_raw <span class="ot">&lt;-</span> chrome_session<span class="sc">$</span>Runtime<span class="sc">$</span><span class="fu">evaluate</span>(</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"document.documentElement.outerHTML"</span>)<span class="sc">$</span>result<span class="sc">$</span>value</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Read html</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>html_rvest <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_raw)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract links from departments</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>links_dept<span class="ot">&lt;-</span> html_rvest <span class="sc">|&gt;</span> </span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="st">".depto_link"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Get department names</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>name_depts <span class="ot">&lt;-</span> links_dept <span class="sc">|&gt;</span> </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">URLdecode</span>() <span class="sc">|&gt;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_split_i</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">/"</span>, <span class="dv">3</span>)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only links that match 'frutas' or 'verduras'</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>links_fyv_id <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"frutas|verduras|legumbres"</span>, </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>                     name_depts, </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>links_fyv <span class="ot">&lt;-</span> links_dept[links_fyv_id]</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop to extract prices from selected departments </span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list to save results</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>lacomer_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(links_fyv)){</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create link</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  link_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://www.lacomer.com.mx/lacomer/"</span>, </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>                      links_fyv[i])</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Go to link</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  chrome_session<span class="sc">$</span>Page<span class="sc">$</span><span class="fu">navigate</span>(link_path)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Wait until webpage is loaded</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">5</span>)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract raw html</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  html_raw_dept <span class="ot">&lt;-</span> chrome_session<span class="sc">$</span>Runtime<span class="sc">$</span><span class="fu">evaluate</span>(</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">"document.documentElement.outerHTML"</span>)<span class="sc">$</span>result<span class="sc">$</span>value</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save data in list</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  current_depto_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  current_depto_data[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">lacomer_data</span>(html_raw_dept)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Search for more pages in department</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  pages_section_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_raw_dept) <span class="sc">|&gt;</span> </span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_element</span>(<span class="st">".paginator-container"</span>)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  n_pags <span class="ot">&lt;-</span> pages_section_html <span class="sc">|&gt;</span> </span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_elements</span>(<span class="st">".ng-binding"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text2</span>()</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If there is more than one page in the department, then extract the </span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data from each page</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(n_pags) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(e <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(n_pags)){</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Click to go to next page</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>      chrome_session<span class="sc">$</span>Runtime<span class="sc">$</span><span class="fu">evaluate</span>(</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>        <span class="at">expression =</span> <span class="st">"Array.from(document.querySelectorAll('a')).</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="st">        find(el =&gt; el.textContent === 'Siguiente').click();"</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Sys.sleep</span>(<span class="dv">10</span>)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Extract raw html</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>      html_raw_dept <span class="ot">&lt;-</span> chrome_session<span class="sc">$</span>Runtime<span class="sc">$</span><span class="fu">evaluate</span>(</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">"document.documentElement.outerHTML"</span>)<span class="sc">$</span>result<span class="sc">$</span>value</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>      current_depto_data[[e]] <span class="ot">&lt;-</span> <span class="fu">lacomer_data</span>(html_raw_dept)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>  lacomer_list[[i]] <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(current_depto_data)</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>supermarket_list[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(lacomer_list)</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Save data# Save data# Save data</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="co"># file_name_lc &lt;- paste0("../data/lacomer_", Sys.Date(), ".csv")</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="co"># rio::export(supermarket_list[[1]], </span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a><span class="co">#             file_name_lc)</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a><span class="do">##### 02. Walmart</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch browser</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">CHROMOTE_HEADLESS =</span> <span class="st">"0"</span>)</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>my_user_agent <span class="ot">&lt;-</span> <span class="st">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36"</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new browser session</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>chrome_session <span class="ot">&lt;-</span> ChromoteSession<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>chrome_session<span class="sc">$</span>Network<span class="sc">$</span><span class="fu">setUserAgentOverride</span>(<span class="at">userAgent =</span> my_user_agent)</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch chrome to view actions taken in the browser</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>chrome_session<span class="sc">$</span><span class="fu">view</span>()</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty list to save data</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>walmart_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Go to webpage</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>chrome_session<span class="sc">$</span>Page<span class="sc">$</span><span class="fu">navigate</span>(</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://www.walmart.com.mx/content/frutas-y-verduras/120007"</span>)</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Wait until webpage is loaded</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="dv">3</span>)</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>department_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Frutas"</span>, <span class="st">"Verduras"</span>, <span class="st">"Jitomates, Aguacates y básicos"</span>)</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (dept <span class="cf">in</span> department_names){</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>  chrome_session<span class="sc">$</span>Page<span class="sc">$</span><span class="fu">navigate</span>(</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.walmart.com.mx/content/frutas-y-verduras/120007"</span>)</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">3</span>)</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>  js_expr <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"Array.from(document.querySelectorAll('button')).</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="st">        find(el =&gt; el.textContent === '{dept}').click();"</span>)</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>  chrome_session<span class="sc">$</span>Runtime<span class="sc">$</span><span class="fu">evaluate</span>(</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">expression =</span> js_expr</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">4</span>)</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>  html_raw_dept <span class="ot">&lt;-</span> chrome_session<span class="sc">$</span>Runtime<span class="sc">$</span><span class="fu">evaluate</span>(</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    <span class="st">"document.documentElement.outerHTML"</span>)<span class="sc">$</span>result<span class="sc">$</span>value</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>  html_raw_dept <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_raw_dept)</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>  html_subdepts_links <span class="ot">&lt;-</span> html_raw_dept <span class="sc">|&gt;</span> </span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_nodes</span>(<span class="st">"a[data-dca-id='L:0099F98E09']"</span>)<span class="sc">|&gt;</span> </span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>  subdept_names <span class="ot">&lt;-</span> <span class="fu">str_split_i</span>(html_subdepts_links, <span class="st">"/"</span>, <span class="dv">5</span>)</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>  subdept_ids <span class="ot">&lt;-</span> <span class="fu">which</span>(subdept_names <span class="sc">%in%</span> </span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">c</span>(<span class="st">"aderezos-y-jugos-naturales"</span>, </span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"bactericidas"</span>, </span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"ensaladas-y-empacados"</span>))</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>  html_subdepts_links_sel <span class="ot">&lt;-</span> html_subdepts_links[<span class="sc">-</span>subdept_ids]</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>  subdept_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(html_subdepts_links_sel)){</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>    link <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://www.walmart.com.mx"</span>, html_subdepts_links_sel[i])</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>    chrome_session<span class="sc">$</span>Page<span class="sc">$</span><span class="fu">navigate</span>(link)</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">5</span>)</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    chrome_session<span class="sc">$</span>Runtime<span class="sc">$</span><span class="fu">evaluate</span>(<span class="st">"Array.from(document.querySelectorAll('button')).</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a><span class="st">        find(el =&gt; el.textContent === 'Marca').click();"</span>)</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    chrome_session<span class="sc">$</span>Runtime<span class="sc">$</span><span class="fu">evaluate</span>(<span class="st">"</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a><span class="st">    var spans = document.querySelectorAll('span');</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a><span class="st">    var target = Array.from(spans).find(el =&gt; el.textContent === 'Frutas Y Verduras Frescas');</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a><span class="st">    if (target) { target.click(); }"</span>)</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">1</span>)</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>    chrome_session<span class="sc">$</span>Runtime<span class="sc">$</span><span class="fu">evaluate</span>(<span class="st">"(() =&gt; {</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a><span class="st">    const buttons = Array.from(document.querySelectorAll('button'));</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a><span class="st">    const target = buttons.find(btn =&gt; btn.innerText.includes('Ver resultados'));</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a><span class="st">    if (target) {</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a><span class="st">      target.click();</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a><span class="st">  })()"</span>)</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">5</span>)</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>    html_raw_subdept <span class="ot">&lt;-</span> chrome_session<span class="sc">$</span>Runtime<span class="sc">$</span><span class="fu">evaluate</span>(</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>      <span class="st">"document.documentElement.outerHTML"</span>)<span class="sc">$</span>result<span class="sc">$</span>value</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>    html_rvest_subdept <span class="ot">&lt;-</span> <span class="fu">read_html</span>(html_raw_subdept)</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>    subdept_list[[i]] <span class="ot">&lt;-</span> <span class="fu">walmart_data</span>(html_rvest_subdept)</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>  walmart_list[[dept]] <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(subdept_list)</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>supermarket_list[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(walmart_list)</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>df_supermarket <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(supermarket_list)</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>df_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"data/raw/supermarket_data_"</span>, </span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">Sys.Date</span>(), </span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>                         <span class="st">".csv"</span>)</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>rio<span class="sc">::</span><span class="fu">export</span>(df_supermarket, </span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>            df_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><strong>Monte Carlo Simulation</strong>: Used to model price variability from wholesale data and generate probabilistic proxies for informal market prices</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Click to see stochastic modeling to obtain street market price proxies (04_local_price_simulator.R)</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Local shop price simulator</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>central_data <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">"data/raw/central_abastos_2026-02-13.csv"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproductibility</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">111</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define number os simualtions</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Price simulation</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>local_prices_sim <span class="ot">&lt;-</span> central_data <span class="sc">|&gt;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), <span class="at">each =</span> n_sim)) <span class="sc">|&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(product_name) <span class="sc">|&gt;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sim_id =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin =</span> <span class="fu">runif</span>(<span class="fu">n</span>(), <span class="at">min =</span> <span class="fl">0.15</span>, <span class="at">max =</span> <span class="fl">0.40</span>),</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">price_per_unit =</span> price_freq <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> margin) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">mean =</span> <span class="dv">0</span>, </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">sd =</span> <span class="fl">0.03</span>))) <span class="sc">|&gt;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">seller =</span> <span class="fu">paste0</span>(<span class="st">"local_market_"</span>, <span class="fu">round</span>(margin <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>))) <span class="sc">|&gt;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(product_name, </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>         price_per_unit, </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>         quantity, </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>         unit, </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>         seller, </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>         date, </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>         margin, </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>         sim_id)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Export dataframe</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"data/processed/local_market_data_"</span>, <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>rio<span class="sc">::</span><span class="fu">export</span>(local_prices_sim, file_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-refinement" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="data-refinement"><span class="header-section-number">3.3</span> Data Refinement</h2>
<section id="unit-standardization-and-price-normalization" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="unit-standardization-and-price-normalization"><span class="header-section-number">3.3.1</span> Unit Standardization and Price Normalization</h3>
<p>Raw data from websites is inherently messy. A product could be listed as “1 kg,” “1k,” “1000 g,” or even as a single unit like “1 pieza.” To be able to compare, I created modular cleaning functions (stored in <code>00_helpers.R</code>) tailored to each data source’s quirks. The core task was to extract the numeric quantity and unit, then convert all prices to a standard metric: <strong>Price per Kilogram ($/kg)</strong>.</p>
<div class="cell">
<details class="code-fold">
<summary>Click to see the cleaning function for ‘Dilmun’ products (00_helpers. R)</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dilmun_data <span class="ot">&lt;-</span> <span class="cf">function</span>(raw_html){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  product_nodes <span class="ot">&lt;-</span> raw_html_1 <span class="sc">|&gt;</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_nodes</span>(<span class="st">".product-card"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  raw_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">raw_text =</span> product_nodes <span class="sc">|&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_elements</span>(<span class="st">".product-card-title"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_text2</span>(),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">price =</span> product_nodes <span class="sc">|&gt;</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_elements</span>(<span class="st">".price-item-regular"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_text2</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>      readr<span class="sc">::</span><span class="fu">parse_number</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>()</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  clean_df <span class="ot">&lt;-</span> raw_df <span class="sc">|&gt;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">quantity =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(raw_text, <span class="st">"(?i)manojo"</span>) <span class="sc">~</span> <span class="st">"1"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">str_extract</span>(raw_text, <span class="st">"</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*(?=</span><span class="sc">\\</span><span class="st">s*(kg|g|k|pz|pieza|pza))"</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">unit =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(raw_text, <span class="st">"(?i)kg"</span>) <span class="sc">~</span> <span class="st">"kg"</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(raw_text, <span class="st">"(?i)g"</span>) <span class="sc">~</span> <span class="st">"g"</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(raw_text, <span class="st">"(?i)pieza|pz"</span>) <span class="sc">~</span> <span class="st">"pza"</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">str_extract</span>(raw_text, <span class="st">"(?i)manojo"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_to_lower</span>()</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">product_name =</span> raw_text <span class="sc">|&gt;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">(.*?</span><span class="sc">\\</span><span class="st">)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_remove_all</span>(<span class="st">"(?i)</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*</span><span class="sc">\\</span><span class="st">s*(kg|g|k|pz|pieza|pza|manojo)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_remove_all</span>(</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>          <span class="st">"(?i)aprox</span><span class="sc">\\</span><span class="st">.?|en domo|domo|en manojo|importado|Proyecto Distinto|Campo Vivo"</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+[a-zA-Z]$"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_squish</span>() <span class="sc">|&gt;</span> </span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_remove_all</span>(<span class="st">"[[:punct:]]$"</span>),</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> <span class="fu">Sys.Date</span>(),</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">seller =</span> <span class="st">"dilmun"</span> </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(product_name, price, quantity, unit, date, seller)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  clean_df</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I applied the following normalization formula:</p>
<p>$$Price_{kg} = \frac{Price_{total}}{Quantity_{total}} \times Factor$$</p>
<p><strong>Where:</strong></p>
<ul>
<li><p><span class="math inline">\(Price_{total}\)</span>: The price listed on the website.</p></li>
<li><p><span class="math inline">\(Quantity_{total}\)</span>: The numeric value of the weight or volume extracted.</p></li>
<li><p><span class="math inline">\(Factor\)</span>: A conversion coefficient (e.g., <span class="math inline">\(1000\)</span> for grams, <span class="math inline">\(1\)</span> for kilograms) to ensure the final output is consistently represented in kilograms.</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Click to see the code employed for price normalizations (05_clean_data.R)</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversion data (piezas or manojo to kilograms)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>conv_data <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">"data/units_conversion.csv"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df_w_conv <span class="ot">&lt;-</span> selected_products <span class="sc">|&gt;</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(conv_data, <span class="at">by =</span> <span class="st">"product_group"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price_per_unit =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    tier <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"agroecological"</span>, <span class="st">"supermarket"</span>) <span class="sc">&amp;</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(unit, <span class="st">"manojo|pza"</span>) <span class="sc">~</span> (pieces_per_kg <span class="sc">*</span> price),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    tier <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"agroecological"</span>, <span class="st">"supermarket"</span>) <span class="sc">&amp;</span> </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(unit, <span class="st">"kg"</span>) <span class="sc">~</span>  (price<span class="sc">/</span>quantity),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    tier <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"agroecological"</span>, <span class="st">"supermarket"</span>) <span class="sc">&amp;</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(unit, <span class="st">"g"</span>) <span class="sc">~</span> (price<span class="sc">/</span>quantity)<span class="sc">*</span><span class="dv">1000</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> price_per_unit</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(product_name, product_group, price_per_unit, tier, seller, date, margin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="product-selection-scope-the-basic-basket" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="product-selection-scope-the-basic-basket"><span class="header-section-number">3.3.2</span> Product Selection &amp; Scope: The Basic Basket</h3>
<p>To ensure the study reflects the real-world economic pressures faced by Mexico City residents, I focused the analysis on fruits and vegetable from the <strong>Basic Basket</strong> (Basic Food Basket).</p>
<p>After selecting these products, web scraping returns “false positives.” I implemented a secondary filtering layer using Regular Expressions (Regex) to remove items that match the product names but do not belong in a food basket (e.g., “flor de zanahoria”, “disfraz de jitomate”, or processed teas).</p>
<div class="cell">
<details class="code-fold">
<summary>Click to see the code for filtering and removing noise from names of selected products (05_clean_data.R)</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of products to analyze</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>selected_products <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">"data/selected_products.csv"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create character string to search for selected products in master dataframe</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>search_words <span class="ot">&lt;-</span> <span class="fu">paste0</span>(selected_products<span class="sc">$</span>product_name, <span class="at">collapse =</span> <span class="st">"|"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data to remove noise </span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>noise_wrds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"flor"</span>,<span class="st">"4x"</span>,<span class="st">"brote"</span>,<span class="st">"hallowen"</span>,<span class="st">"brujita"</span>,<span class="st">"fantasia"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"te de"</span>,<span class="st">"sin cáscara"</span>,<span class="st">"polvo"</span>,<span class="st">"de colores"</span>, <span class="st">"naturesweet"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>varieties <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"uva"</span>, <span class="st">"valenciano"</span>, <span class="st">"morado"</span>, <span class="st">"macho"</span>, <span class="st">"calabaza bola"</span>, </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>               <span class="st">"pay"</span>,<span class="st">"castilla"</span>,<span class="st">"coliflor"</span>,<span class="st">"flor"</span>,<span class="st">"germinado"</span>,<span class="st">"hoja"</span>,<span class="st">"baby"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>               <span class="st">"cherry"</span>,<span class="st">"heirloom"</span>,<span class="st">"jugo"</span>,<span class="st">"microgreens"</span>,<span class="st">"cambray"</span>,<span class="st">"papalo"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>               <span class="st">"pimiento"</span>,<span class="st">"dominico"</span>, <span class="st">"campari"</span>, <span class="st">"butternut"</span>, <span class="st">"acorn"</span>, </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>               <span class="st">"criolla"</span>, <span class="st">"de rabo"</span>, <span class="st">"blood orange"</span>, <span class="st">"pink navel"</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>               <span class="st">"eureka"</span>, <span class="st">"té"</span>, <span class="st">"japonesa"</span>, <span class="st">"eureka"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">b("</span>, </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">paste</span>(<span class="fu">c</span>(noise_wrds, </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                           varieties), </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">collapse =</span> <span class="st">"|"</span>), </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                   <span class="st">")</span><span class="sc">\\</span><span class="st">b"</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>selected_products <span class="ot">&lt;-</span> master_df <span class="sc">|&gt;</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">product_name =</span> <span class="fu">str_to_lower</span>(product_name) <span class="sc">|&gt;</span> <span class="fu">str_squish</span>()) <span class="sc">|&gt;</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(product_name, search_words)) <span class="sc">|&gt;</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(product_name, noise))</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Create column product_group</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>selected_products <span class="ot">&lt;-</span> selected_products <span class="sc">|&gt;</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">product_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"aguacate|aguacate hass"</span>) <span class="sc">~</span> <span class="st">"aguacate"</span>,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"calabaza|calabacita|calabacitas"</span>) <span class="sc">~</span> <span class="st">"calabaza"</span>,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"cebolla|cebolla blanca"</span>) <span class="sc">~</span> <span class="st">"cebolla"</span>,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"chayote"</span>) <span class="sc">~</span> <span class="st">"chayote"</span>,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"espinaca"</span>) <span class="sc">~</span> <span class="st">"espinaca"</span>,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"jitomate|tomate saladette|tomate bola"</span>) <span class="sc">~</span> <span class="st">"jitomate"</span>,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"limon|limón"</span>) <span class="sc">~</span> <span class="st">"limon"</span>,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"manzana"</span>) <span class="sc">~</span> <span class="st">"manzana"</span>,</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"melon|melón"</span>) <span class="sc">~</span> <span class="st">"melon"</span>,</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"naranja"</span>) <span class="sc">~</span> <span class="st">"naranja"</span>,</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"nopal|nopales"</span>) <span class="sc">~</span> <span class="st">"nopal"</span>,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"papaya"</span>) <span class="sc">~</span> <span class="st">"papaya"</span>,</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"</span><span class="sc">\\</span><span class="st">bpapa</span><span class="sc">\\</span><span class="st">b"</span>) <span class="sc">~</span> <span class="st">"papa"</span>,</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"platano|plátano"</span>) <span class="sc">~</span> <span class="st">"platano"</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"tomate verde|tomatillo"</span>) <span class="sc">~</span> <span class="st">"tomate"</span>,</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(product_name, <span class="st">"zanahoria"</span>) <span class="sc">~</span> <span class="st">"zanahoria"</span>, </span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> product_name</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="stochastic-modeling" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="stochastic-modeling"><span class="header-section-number">3.4</span> Stochastic Modeling</h2>
<p>To approximate informal market prices derived from wholesale data, I implemented a Monte Carlo-style simulation using observed minimum, frequent, and maximum prices from Central de Abasto.</p>
<p>Each simulation sampled within these bounds to generate a distribution of plausible retail prices, allowing estimation of expected value and variance rather than relying on a single point estimate.</p>
</section>
<section id="price-volatility" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="price-volatility"><span class="header-section-number">3.5</span> Price Volatility</h2>
<p>I estimated the volatility for selected product through the Coefficient of Variation (<span class="math inline">\(CV = \frac{\sigma}{\mu} \times 100\)</span>). This measure quantifies how spread out data points are relative to the mean, allowing for the comparison of variability between datasets with different units or scales. In this study, CV allows us to compare price volatility across tiers regardless of the average price point. A higher CV indicates greater price instability.</p>
</section>
<section id="the-price-gap" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="the-price-gap"><span class="header-section-number">3.6</span> The Price Gap</h2>
<p>To quantify the economic barrier to accessing sustainable food from agroecologic markets, I calculated the Price Gap. This metric represents the percentage increase a consumer pays when switching from an industrial or informal option to an agroecological one.</p>
<p>I compared the median price of each product to avoid the skewing effect of outliers. The gap is calculated as:</p>
<p><span class="math display">\[\text{Gap (%)} = \left( \frac{\text{Price}_{Agro} - \text{Price}_{Baseline}}{\text{Price}_{Baseline}} \right) \times 100\]</span></p>
</section>
<section id="economic-viability-labor-cost-translation" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="economic-viability-labor-cost-translation"><span class="header-section-number">3.7</span> Economic Viability (<strong>Labor Cost Translation)</strong></h2>
<p>To assess the economic accessibility to the different food systems, I constructed a Monthly Basic Basket simulation. I integrated a monthly consumption dataset (‘monthly_consumption.csv’) which has an estimation of the typical quantity (kg) of each product consumed by a household in a month. The monthly cost per product group (<span class="math inline">\(C_{m}\)</span>) was calculated as:</p>
<p><span class="math display">\[C_{m} = \bar{P} \times Q_{m}\]</span></p>
<p>Where <span class="math inline">\(\bar{P}\)</span> is the mean price per unit and <span class="math inline">\(Q_{m}\)</span> is the monthly consumption quantity.</p>
<p>To measure “Affordability” the total basket cost was benchmarked against the 2026 Mexican Daily Minimum Wage ($315.04 MXN). I calculated two primary indicators:</p>
<ol type="1">
<li><p>Wage Percentage. The portion of a total monthly minimum wage (30 days) required to cover the basket.</p></li>
<li><p>Work Days. The specific number of full labor days needed to afford these essential fruits and vegetables.</p></li>
</ol>
</section>
</section>
<section id="results" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Results</h1>
<section id="price-distributions-and-volatility" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="price-distributions-and-volatility"><span class="header-section-number">4.1</span> Price Distributions and Volatility</h2>
<p>The density plot below visualizes the distribution of prices ($/kg) for all products within each tier. The x-axis is on a logarithmic scale, which allows us to see the spread of lower-priced staples while still encompassing the higher-end premium products.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-density" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-density-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-density-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-density-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Price Density per Market Tier (Log Scale)
</figcaption>
</figure>
</div>
</div>
</div>
<p>The summary table below confirms what the density plot suggests. While the <strong>Local</strong> tier offers the lowest entry price and the lowest median price, the <strong>Supermarket</strong> tier exhibits the highest price volatility, with a Coefficient of Variation (CV) of <strong>98.08</strong>. This high CV likely reflects the supermarket strategy of offering a wide spectrum of goods leading staples to high-margin, “gourmet” or organic options. This creates a highly variable price landscape for the consumer.</p>
<div id="tbl-summ-stats" class="cell anchored">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Market Tier</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Min</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Median</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Max</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CV (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">agroecological</td>
<td style="text-align: right;">21.20</td>
<td style="text-align: right;">60.00</td>
<td style="text-align: right;">74.49</td>
<td style="text-align: right;">438.89</td>
<td style="text-align: right;">58.21</td>
<td style="text-align: right;">78.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">local</td>
<td style="text-align: right;">4.88</td>
<td style="text-align: right;">20.26</td>
<td style="text-align: right;">24.39</td>
<td style="text-align: right;">80.77</td>
<td style="text-align: right;">14.42</td>
<td style="text-align: right;">59.14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">supermarket</td>
<td style="text-align: right;">13.90</td>
<td style="text-align: right;">53.50</td>
<td style="text-align: right;">78.21</td>
<td style="text-align: right;">438.33</td>
<td style="text-align: right;">76.71</td>
<td style="text-align: right;">98.08</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="quantifying-the-green-premium" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="quantifying-the-green-premium"><span class="header-section-number">4.2</span> Quantifying the “Green Premium”</h2>
<p>The price gap analysis puts a number on the cost of choosing agroecological options.</p>
<p>On average, purchasing the fruits and vegetables from the Basic Basket from an agroecological market represents a <strong>36.4%</strong> increase in cost compared to supermarkets, and a <strong>278%</strong> increase compared to local street markets.</p>
<div id="tbl-gap-summ" class="cell anchored">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Agroecological vs.&nbsp;Supermarket Gap</th>
<th style="text-align: right;">Agroecological vs.&nbsp;Local Gap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">36.44</td>
<td style="text-align: right;">277.68</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The following dumbbell plot visualizes these gaps for individual products. Each product is a line connecting its price in the local and supermarket tiers to its price in the agroecological tier. This highlights that while agroecology is almost universally more expensive, the magnitude of the gap varies wildly by product.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-price-gap" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-price-gap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-price-gap-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-price-gap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Price Gaps. Graph shows the distance between Local, Supermarket, and Agroecological prices.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Price Gap of Selected Products Table (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>The following table shows the price gap by product. Negative values indicate products that are cheaper in agroecological tier</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 25%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Product</th>
<th style="text-align: right;">Agroecological price</th>
<th style="text-align: right;">Local price</th>
<th style="text-align: right;">Supermarket price</th>
<th style="text-align: right;">Agroecological vs Supermarket Gap</th>
<th style="text-align: right;">Agroecological vs Local Markets Gap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">aguacate</td>
<td style="text-align: right;">134.00</td>
<td style="text-align: right;">45.42</td>
<td style="text-align: right;">88.90</td>
<td style="text-align: right;">50.73</td>
<td style="text-align: right;">195.05</td>
</tr>
<tr class="even">
<td style="text-align: left;">calabaza</td>
<td style="text-align: right;">45.00</td>
<td style="text-align: right;">10.41</td>
<td style="text-align: right;">69.90</td>
<td style="text-align: right;">-35.62</td>
<td style="text-align: right;">332.34</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cebolla</td>
<td style="text-align: right;">50.00</td>
<td style="text-align: right;">6.35</td>
<td style="text-align: right;">27.90</td>
<td style="text-align: right;">79.21</td>
<td style="text-align: right;">687.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">chayote</td>
<td style="text-align: right;">54.27</td>
<td style="text-align: right;">17.68</td>
<td style="text-align: right;">34.90</td>
<td style="text-align: right;">55.50</td>
<td style="text-align: right;">206.87</td>
</tr>
<tr class="odd">
<td style="text-align: left;">chile serrano</td>
<td style="text-align: right;">170.00</td>
<td style="text-align: right;">16.34</td>
<td style="text-align: right;">49.45</td>
<td style="text-align: right;">243.78</td>
<td style="text-align: right;">940.55</td>
</tr>
<tr class="even">
<td style="text-align: left;">espinaca</td>
<td style="text-align: right;">89.29</td>
<td style="text-align: right;">23.17</td>
<td style="text-align: right;">209.15</td>
<td style="text-align: right;">-57.31</td>
<td style="text-align: right;">285.33</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jitomate</td>
<td style="text-align: right;">58.00</td>
<td style="text-align: right;">27.90</td>
<td style="text-align: right;">39.90</td>
<td style="text-align: right;">45.36</td>
<td style="text-align: right;">107.92</td>
</tr>
<tr class="even">
<td style="text-align: left;">limon</td>
<td style="text-align: right;">56.00</td>
<td style="text-align: right;">33.06</td>
<td style="text-align: right;">57.10</td>
<td style="text-align: right;">-1.93</td>
<td style="text-align: right;">69.38</td>
</tr>
<tr class="odd">
<td style="text-align: left;">manzana</td>
<td style="text-align: right;">72.00</td>
<td style="text-align: right;">59.86</td>
<td style="text-align: right;">49.90</td>
<td style="text-align: right;">44.29</td>
<td style="text-align: right;">20.29</td>
</tr>
<tr class="even">
<td style="text-align: left;">melon</td>
<td style="text-align: right;">53.33</td>
<td style="text-align: right;">17.74</td>
<td style="text-align: right;">51.30</td>
<td style="text-align: right;">3.96</td>
<td style="text-align: right;">200.58</td>
</tr>
<tr class="odd">
<td style="text-align: left;">naranja</td>
<td style="text-align: right;">68.00</td>
<td style="text-align: right;">14.53</td>
<td style="text-align: right;">43.90</td>
<td style="text-align: right;">54.90</td>
<td style="text-align: right;">368.15</td>
</tr>
<tr class="even">
<td style="text-align: left;">papa</td>
<td style="text-align: right;">48.00</td>
<td style="text-align: right;">15.65</td>
<td style="text-align: right;">39.90</td>
<td style="text-align: right;">20.30</td>
<td style="text-align: right;">206.72</td>
</tr>
<tr class="odd">
<td style="text-align: left;">papaya</td>
<td style="text-align: right;">83.33</td>
<td style="text-align: right;">34.09</td>
<td style="text-align: right;">39.90</td>
<td style="text-align: right;">108.86</td>
<td style="text-align: right;">144.42</td>
</tr>
<tr class="even">
<td style="text-align: left;">platano</td>
<td style="text-align: right;">39.00</td>
<td style="text-align: right;">19.67</td>
<td style="text-align: right;">33.40</td>
<td style="text-align: right;">16.77</td>
<td style="text-align: right;">98.31</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tomate</td>
<td style="text-align: right;">55.00</td>
<td style="text-align: right;">32.97</td>
<td style="text-align: right;">78.73</td>
<td style="text-align: right;">-30.14</td>
<td style="text-align: right;">66.83</td>
</tr>
<tr class="even">
<td style="text-align: left;">zanahoria</td>
<td style="text-align: right;">50.00</td>
<td style="text-align: right;">8.16</td>
<td style="text-align: right;">59.25</td>
<td style="text-align: right;">-15.61</td>
<td style="text-align: right;">513.06</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="economic-viability" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="economic-viability"><span class="header-section-number">4.3</span> Economic Viability</h2>
<p>To improve interpretability, prices were translated into labor-equivalent terms by benchmarking basket costs against the 2026 Mexican daily minimum wage (315.04 MXN).</p>
<section id="basic-basket-cost" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="basic-basket-cost"><span class="header-section-number">4.3.1</span> Basic Basket cost</h3>
<p>The local market emerges as the most economically accessible option, with a monthly basket costing <strong>$380.69MXN</strong>. The supermarket basket is slightly more expensive at <strong>$842.4 MXN</strong>. However, the agroecological basket commands a significant premium at <strong>$1106.11 MXN</strong>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-basket-visual" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-basket-visual-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-basket-visual-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-basket-visual-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Monthly total basket cost among tiers
</figcaption>
</figure>
</div>
</div>
</div>
<p>The results highlight a clear disparity in how each market tier impacts the purchasing power of minimum-wage workers:</p>
<ul>
<li><p><strong>Local Market</strong>: TThe most economically accessible option, requiring approximately <strong>1.21 days of work per month</strong> to afford the basket.</p></li>
<li><p><strong>Supermarket</strong>: A moderately higher burden, equivalent to <strong>2.67 days of work</strong>.</p></li>
<li><p><strong>Agroecological Market</strong>: The highest labor cost, requiring <strong>3.51 days of work</strong> to purchase the same set of fruits and vegetables.</p></li>
</ul>
<p>In practical terms, choosing the agroecological option more than doubles the labor required compared to local markets, illustrating how price differentials translate directly into meaningful differences in economic accessibility.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Tier</th>
<th style="text-align: right;">Percentage of Minimum Monthly Wage</th>
<th style="text-align: right;">Work Days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">agroecological</td>
<td style="text-align: right;">11.70</td>
<td style="text-align: right;">3.51</td>
</tr>
<tr class="even">
<td style="text-align: left;">local</td>
<td style="text-align: right;">4.03</td>
<td style="text-align: right;">1.21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">supermarket</td>
<td style="text-align: right;">8.91</td>
<td style="text-align: right;">2.67</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-basket" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-basket-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-basket-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-basket-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Product contribution to basic basket cost
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="limitations" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Limitations</h1>
<ul>
<li>Web-scraped prices may change daily.</li>
<li>Product equivalence across tiers may not be perfect (quality differences).</li>
<li>Central de Abasto proxy assumes wholesale-to-retail price behavior.</li>
<li>Only fruits and vegetables were analyzed.</li>
</ul>
</section>
<section id="conclusion" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Conclusion</h1>
<p>This analysis confirms the presence of a measurable Green Premium in Mexico City’s food system. Agroecological products are consistently more expensive, and the associated labor cost burden is significantly higher for minimum-wage households.</p>
<p>However, price variability within supermarket tiers reveals structural heterogeneity in industrial retail markets. Meanwhile, local market proxies demonstrate comparatively lower and more stable prices.</p>
<p>From a data perspective, the findings illustrate how price dispersion, supply chain structure, and income constraints interact to shape food accessibility.</p>
<p>Bridging the economic gap in sustainable food systems will likely require structural interventions beyond individual consumer choice.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>